{"ast":null,"code":"import UPNG from '@pdf-lib/upng';\nvar getImageType = function getImageType(ctype) {\n  if (ctype === 0) return PngType.Greyscale;\n  if (ctype === 2) return PngType.Truecolour;\n  if (ctype === 3) return PngType.IndexedColour;\n  if (ctype === 4) return PngType.GreyscaleWithAlpha;\n  if (ctype === 6) return PngType.TruecolourWithAlpha;\n  throw new Error(\"Unknown color type: \" + ctype);\n};\nvar splitAlphaChannel = function splitAlphaChannel(rgbaChannel) {\n  var pixelCount = Math.floor(rgbaChannel.length / 4);\n  var rgbChannel = new Uint8Array(pixelCount * 3);\n  var alphaChannel = new Uint8Array(pixelCount * 1);\n  var rgbaOffset = 0;\n  var rgbOffset = 0;\n  var alphaOffset = 0;\n  while (rgbaOffset < rgbaChannel.length) {\n    rgbChannel[rgbOffset++] = rgbaChannel[rgbaOffset++];\n    rgbChannel[rgbOffset++] = rgbaChannel[rgbaOffset++];\n    rgbChannel[rgbOffset++] = rgbaChannel[rgbaOffset++];\n    alphaChannel[alphaOffset++] = rgbaChannel[rgbaOffset++];\n  }\n  return {\n    rgbChannel: rgbChannel,\n    alphaChannel: alphaChannel\n  };\n};\nexport var PngType;\n(function (PngType) {\n  PngType[\"Greyscale\"] = \"Greyscale\";\n  PngType[\"Truecolour\"] = \"Truecolour\";\n  PngType[\"IndexedColour\"] = \"IndexedColour\";\n  PngType[\"GreyscaleWithAlpha\"] = \"GreyscaleWithAlpha\";\n  PngType[\"TruecolourWithAlpha\"] = \"TruecolourWithAlpha\";\n})(PngType || (PngType = {}));\nvar PNG = /** @class */function () {\n  function PNG(pngData) {\n    var upng = UPNG.decode(pngData);\n    var frames = UPNG.toRGBA8(upng);\n    if (frames.length > 1) throw new Error(\"Animated PNGs are not supported\");\n    var frame = new Uint8Array(frames[0]);\n    var _a = splitAlphaChannel(frame),\n      rgbChannel = _a.rgbChannel,\n      alphaChannel = _a.alphaChannel;\n    this.rgbChannel = rgbChannel;\n    var hasAlphaValues = alphaChannel.some(function (a) {\n      return a < 255;\n    });\n    if (hasAlphaValues) this.alphaChannel = alphaChannel;\n    this.type = getImageType(upng.ctype);\n    this.width = upng.width;\n    this.height = upng.height;\n    this.bitsPerComponent = 8;\n  }\n  PNG.load = function (pngData) {\n    return new PNG(pngData);\n  };\n  return PNG;\n}();\nexport { PNG };","map":{"version":3,"mappings":"AAAA,OAAOA,IAAI,MAAM,eAAe;AAEhC,IAAMC,YAAY,GAAG,SAAfA,YAAY,CAAIC,KAAa;EACjC,IAAIA,KAAK,KAAK,CAAC,EAAE,OAAOC,OAAO,CAACC,SAAS;EACzC,IAAIF,KAAK,KAAK,CAAC,EAAE,OAAOC,OAAO,CAACE,UAAU;EAC1C,IAAIH,KAAK,KAAK,CAAC,EAAE,OAAOC,OAAO,CAACG,aAAa;EAC7C,IAAIJ,KAAK,KAAK,CAAC,EAAE,OAAOC,OAAO,CAACI,kBAAkB;EAClD,IAAIL,KAAK,KAAK,CAAC,EAAE,OAAOC,OAAO,CAACK,mBAAmB;EACnD,MAAM,IAAIC,KAAK,CAAC,yBAAuBP,KAAO,CAAC;AACjD,CAAC;AAED,IAAMQ,iBAAiB,GAAG,SAApBA,iBAAiB,CAAIC,WAAuB;EAChD,IAAMC,UAAU,GAAGC,IAAI,CAACC,KAAK,CAACH,WAAW,CAACI,MAAM,GAAG,CAAC,CAAC;EAErD,IAAMC,UAAU,GAAG,IAAIC,UAAU,CAACL,UAAU,GAAG,CAAC,CAAC;EACjD,IAAMM,YAAY,GAAG,IAAID,UAAU,CAACL,UAAU,GAAG,CAAC,CAAC;EAEnD,IAAIO,UAAU,GAAG,CAAC;EAClB,IAAIC,SAAS,GAAG,CAAC;EACjB,IAAIC,WAAW,GAAG,CAAC;EAEnB,OAAOF,UAAU,GAAGR,WAAW,CAACI,MAAM,EAAE;IACtCC,UAAU,CAACI,SAAS,EAAE,CAAC,GAAGT,WAAW,CAACQ,UAAU,EAAE,CAAC;IACnDH,UAAU,CAACI,SAAS,EAAE,CAAC,GAAGT,WAAW,CAACQ,UAAU,EAAE,CAAC;IACnDH,UAAU,CAACI,SAAS,EAAE,CAAC,GAAGT,WAAW,CAACQ,UAAU,EAAE,CAAC;IACnDD,YAAY,CAACG,WAAW,EAAE,CAAC,GAAGV,WAAW,CAACQ,UAAU,EAAE,CAAC;;EAGzD,OAAO;IAAEH,UAAU;IAAEE,YAAY;EAAA,CAAE;AACrC,CAAC;AAED,WAAYf,OAMX;AAND,WAAYA,OAAO;EACjBA,kCAAuB;EACvBA,oCAAyB;EACzBA,0CAA+B;EAC/BA,oDAAyC;EACzCA,sDAA2C;AAC7C,CAAC,EANWA,OAAO,KAAPA,OAAO;AAQnB;EAUE,aAAoBmB,OAAmB;IACrC,IAAMC,IAAI,GAAGvB,IAAI,CAACwB,MAAM,CAACF,OAAO,CAAC;IACjC,IAAMG,MAAM,GAAGzB,IAAI,CAAC0B,OAAO,CAACH,IAAI,CAAC;IAEjC,IAAIE,MAAM,CAACV,MAAM,GAAG,CAAC,EAAE,MAAM,IAAIN,KAAK,CAAC,iCAAiC,CAAC;IAEzE,IAAMkB,KAAK,GAAG,IAAIV,UAAU,CAACQ,MAAM,CAAC,CAAC,CAAC,CAAC;IACjC,SAA+Bf,iBAAiB,CAACiB,KAAK,CAAC;MAArDX,UAAU;MAAEE,YAAY,kBAA6B;IAE7D,IAAI,CAACF,UAAU,GAAGA,UAAU;IAE5B,IAAMY,cAAc,GAAGV,YAAY,CAACW,IAAI,CAAC,UAACC,CAAC;MAAK,QAAC,GAAG,GAAG;IAAP,CAAO,CAAC;IACxD,IAAIF,cAAc,EAAE,IAAI,CAACV,YAAY,GAAGA,YAAY;IAEpD,IAAI,CAACa,IAAI,GAAG9B,YAAY,CAACsB,IAAI,CAACrB,KAAK,CAAC;IAEpC,IAAI,CAAC8B,KAAK,GAAGT,IAAI,CAACS,KAAK;IACvB,IAAI,CAACC,MAAM,GAAGV,IAAI,CAACU,MAAM;IACzB,IAAI,CAACC,gBAAgB,GAAG,CAAC;EAC3B;EA5BOC,QAAI,GAAG,UAACb,OAAmB;IAAK,WAAIa,GAAG,CAACb,OAAO,CAAC;EAAhB,CAAgB;EA6BzD,UAAC;CAAA,EA9BD;SAAaa,GAAG","names":["UPNG","getImageType","ctype","PngType","Greyscale","Truecolour","IndexedColour","GreyscaleWithAlpha","TruecolourWithAlpha","Error","splitAlphaChannel","rgbaChannel","pixelCount","Math","floor","length","rgbChannel","Uint8Array","alphaChannel","rgbaOffset","rgbOffset","alphaOffset","pngData","upng","decode","frames","toRGBA8","frame","hasAlphaValues","some","a","type","width","height","bitsPerComponent","PNG"],"sourceRoot":"","sources":["../../src/utils/png.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}