{"ast":null,"code":"import PDFRef from \"../objects/PDFRef\";\nimport CharCodes from \"../syntax/CharCodes\";\nimport { copyStringIntoBuffer, padStart } from \"../../utils\";\n/**\n * Entries should be added using the [[addEntry]] and [[addDeletedEntry]]\n * methods **in order of ascending object number**.\n */\nvar PDFCrossRefSection = /** @class */function () {\n  function PDFCrossRefSection(firstEntry) {\n    this.subsections = firstEntry ? [[firstEntry]] : [];\n    this.chunkIdx = 0;\n    this.chunkLength = firstEntry ? 1 : 0;\n  }\n  PDFCrossRefSection.prototype.addEntry = function (ref, offset) {\n    this.append({\n      ref: ref,\n      offset: offset,\n      deleted: false\n    });\n  };\n  PDFCrossRefSection.prototype.addDeletedEntry = function (ref, nextFreeObjectNumber) {\n    this.append({\n      ref: ref,\n      offset: nextFreeObjectNumber,\n      deleted: true\n    });\n  };\n  PDFCrossRefSection.prototype.toString = function () {\n    var section = \"xref\\n\";\n    for (var rangeIdx = 0, rangeLen = this.subsections.length; rangeIdx < rangeLen; rangeIdx++) {\n      var range = this.subsections[rangeIdx];\n      section += range[0].ref.objectNumber + \" \" + range.length + \"\\n\";\n      for (var entryIdx = 0, entryLen = range.length; entryIdx < entryLen; entryIdx++) {\n        var entry = range[entryIdx];\n        section += padStart(String(entry.offset), 10, '0');\n        section += ' ';\n        section += padStart(String(entry.ref.generationNumber), 5, '0');\n        section += ' ';\n        section += entry.deleted ? 'f' : 'n';\n        section += ' \\n';\n      }\n    }\n    return section;\n  };\n  PDFCrossRefSection.prototype.sizeInBytes = function () {\n    var size = 5;\n    for (var idx = 0, len = this.subsections.length; idx < len; idx++) {\n      var subsection = this.subsections[idx];\n      var subsectionLength = subsection.length;\n      var firstEntry = subsection[0];\n      size += 2;\n      size += String(firstEntry.ref.objectNumber).length;\n      size += String(subsectionLength).length;\n      size += 20 * subsectionLength;\n    }\n    return size;\n  };\n  PDFCrossRefSection.prototype.copyBytesInto = function (buffer, offset) {\n    var initialOffset = offset;\n    buffer[offset++] = CharCodes.x;\n    buffer[offset++] = CharCodes.r;\n    buffer[offset++] = CharCodes.e;\n    buffer[offset++] = CharCodes.f;\n    buffer[offset++] = CharCodes.Newline;\n    offset += this.copySubsectionsIntoBuffer(this.subsections, buffer, offset);\n    return offset - initialOffset;\n  };\n  PDFCrossRefSection.prototype.copySubsectionsIntoBuffer = function (subsections, buffer, offset) {\n    var initialOffset = offset;\n    var length = subsections.length;\n    for (var idx = 0; idx < length; idx++) {\n      var subsection = this.subsections[idx];\n      var firstObjectNumber = String(subsection[0].ref.objectNumber);\n      offset += copyStringIntoBuffer(firstObjectNumber, buffer, offset);\n      buffer[offset++] = CharCodes.Space;\n      var rangeLength = String(subsection.length);\n      offset += copyStringIntoBuffer(rangeLength, buffer, offset);\n      buffer[offset++] = CharCodes.Newline;\n      offset += this.copyEntriesIntoBuffer(subsection, buffer, offset);\n    }\n    return offset - initialOffset;\n  };\n  PDFCrossRefSection.prototype.copyEntriesIntoBuffer = function (entries, buffer, offset) {\n    var length = entries.length;\n    for (var idx = 0; idx < length; idx++) {\n      var entry = entries[idx];\n      var entryOffset = padStart(String(entry.offset), 10, '0');\n      offset += copyStringIntoBuffer(entryOffset, buffer, offset);\n      buffer[offset++] = CharCodes.Space;\n      var entryGen = padStart(String(entry.ref.generationNumber), 5, '0');\n      offset += copyStringIntoBuffer(entryGen, buffer, offset);\n      buffer[offset++] = CharCodes.Space;\n      buffer[offset++] = entry.deleted ? CharCodes.f : CharCodes.n;\n      buffer[offset++] = CharCodes.Space;\n      buffer[offset++] = CharCodes.Newline;\n    }\n    return 20 * length;\n  };\n  PDFCrossRefSection.prototype.append = function (currEntry) {\n    if (this.chunkLength === 0) {\n      this.subsections.push([currEntry]);\n      this.chunkIdx = 0;\n      this.chunkLength = 1;\n      return;\n    }\n    var chunk = this.subsections[this.chunkIdx];\n    var prevEntry = chunk[this.chunkLength - 1];\n    if (currEntry.ref.objectNumber - prevEntry.ref.objectNumber > 1) {\n      this.subsections.push([currEntry]);\n      this.chunkIdx += 1;\n      this.chunkLength = 1;\n    } else {\n      chunk.push(currEntry);\n      this.chunkLength += 1;\n    }\n  };\n  PDFCrossRefSection.create = function () {\n    return new PDFCrossRefSection({\n      ref: PDFRef.of(0, 65535),\n      offset: 0,\n      deleted: true\n    });\n  };\n  PDFCrossRefSection.createEmpty = function () {\n    return new PDFCrossRefSection();\n  };\n  return PDFCrossRefSection;\n}();\nexport default PDFCrossRefSection;","map":{"version":3,"mappings":"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","names":["PDFRef","CharCodes","copyStringIntoBuffer","padStart","firstEntry","subsections","chunkIdx","chunkLength","PDFCrossRefSection","ref","offset","append","deleted","nextFreeObjectNumber","section","rangeIdx","rangeLen","length","range","objectNumber","entryIdx","entryLen","entry","String","generationNumber","size","idx","len","subsection","subsectionLength","buffer","initialOffset","x","r","e","f","Newline","copySubsectionsIntoBuffer","firstObjectNumber","Space","rangeLength","copyEntriesIntoBuffer","entries","entryOffset","entryGen","n","currEntry","push","chunk","prevEntry","of"],"sourceRoot":"","sources":["../../../src/core/document/PDFCrossRefSection.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}