{"ast":null,"code":"import PDFDict from \"../objects/PDFDict\";\nimport PDFString from \"../objects/PDFString\";\nimport PDFHexString from \"../objects/PDFHexString\";\nimport PDFName from \"../objects/PDFName\";\nimport PDFNumber from \"../objects/PDFNumber\";\nimport PDFArray from \"../objects/PDFArray\";\nimport PDFRef from \"../objects/PDFRef\";\nimport { findLastMatch } from \"../../utils\";\nimport { MissingDAEntryError, MissingTfOperatorError } from \"../errors\";\n// Examples:\n//   `/Helv 12 Tf` -> ['Helv', '12']\n//   `/HeBo 8.00 Tf` -> ['HeBo', '8.00']\n//   `/HeBo Tf` -> ['HeBo', undefined]\nvar tfRegex = /\\/([^\\0\\t\\n\\f\\r\\ ]+)[\\0\\t\\n\\f\\r\\ ]*(\\d*\\.\\d+|\\d+)?[\\0\\t\\n\\f\\r\\ ]+Tf/;\nvar PDFAcroField = /** @class */function () {\n  function PDFAcroField(dict, ref) {\n    this.dict = dict;\n    this.ref = ref;\n  }\n  PDFAcroField.prototype.T = function () {\n    return this.dict.lookupMaybe(PDFName.of('T'), PDFString, PDFHexString);\n  };\n  PDFAcroField.prototype.Ff = function () {\n    var numberOrRef = this.getInheritableAttribute(PDFName.of('Ff'));\n    return this.dict.context.lookupMaybe(numberOrRef, PDFNumber);\n  };\n  PDFAcroField.prototype.V = function () {\n    var valueOrRef = this.getInheritableAttribute(PDFName.of('V'));\n    return this.dict.context.lookup(valueOrRef);\n  };\n  PDFAcroField.prototype.Kids = function () {\n    return this.dict.lookupMaybe(PDFName.of('Kids'), PDFArray);\n  };\n  // Parent(): PDFDict | undefined {\n  //   return this.dict.lookupMaybe(PDFName.of('Parent'), PDFDict);\n  // }\n  PDFAcroField.prototype.DA = function () {\n    var da = this.dict.lookup(PDFName.of('DA'));\n    if (da instanceof PDFString || da instanceof PDFHexString) return da;\n    return undefined;\n  };\n  PDFAcroField.prototype.setKids = function (kids) {\n    this.dict.set(PDFName.of('Kids'), this.dict.context.obj(kids));\n  };\n  PDFAcroField.prototype.getParent = function () {\n    // const parent = this.Parent();\n    // if (!parent) return undefined;\n    // return new PDFAcroField(parent);\n    var parentRef = this.dict.get(PDFName.of('Parent'));\n    if (parentRef instanceof PDFRef) {\n      var parent_1 = this.dict.lookup(PDFName.of('Parent'), PDFDict);\n      return new PDFAcroField(parent_1, parentRef);\n    }\n    return undefined;\n  };\n  PDFAcroField.prototype.setParent = function (parent) {\n    if (!parent) this.dict.delete(PDFName.of('Parent'));else this.dict.set(PDFName.of('Parent'), parent);\n  };\n  PDFAcroField.prototype.getFullyQualifiedName = function () {\n    var parent = this.getParent();\n    if (!parent) return this.getPartialName();\n    return parent.getFullyQualifiedName() + \".\" + this.getPartialName();\n  };\n  PDFAcroField.prototype.getPartialName = function () {\n    var _a;\n    return (_a = this.T()) === null || _a === void 0 ? void 0 : _a.decodeText();\n  };\n  PDFAcroField.prototype.setPartialName = function (partialName) {\n    if (!partialName) this.dict.delete(PDFName.of('T'));else this.dict.set(PDFName.of('T'), PDFHexString.fromText(partialName));\n  };\n  PDFAcroField.prototype.setDefaultAppearance = function (appearance) {\n    this.dict.set(PDFName.of('DA'), PDFString.of(appearance));\n  };\n  PDFAcroField.prototype.getDefaultAppearance = function () {\n    var DA = this.DA();\n    if (DA instanceof PDFHexString) {\n      return DA.decodeText();\n    }\n    return DA === null || DA === void 0 ? void 0 : DA.asString();\n  };\n  PDFAcroField.prototype.setFontSize = function (fontSize) {\n    var _a;\n    var name = (_a = this.getFullyQualifiedName()) !== null && _a !== void 0 ? _a : '';\n    var da = this.getDefaultAppearance();\n    if (!da) throw new MissingDAEntryError(name);\n    var daMatch = findLastMatch(da, tfRegex);\n    if (!daMatch.match) throw new MissingTfOperatorError(name);\n    var daStart = da.slice(0, daMatch.pos - daMatch.match[0].length);\n    var daEnd = daMatch.pos <= da.length ? da.slice(daMatch.pos) : '';\n    var fontName = daMatch.match[1];\n    var modifiedDa = daStart + \" /\" + fontName + \" \" + fontSize + \" Tf \" + daEnd;\n    this.setDefaultAppearance(modifiedDa);\n  };\n  PDFAcroField.prototype.getFlags = function () {\n    var _a, _b;\n    return (_b = (_a = this.Ff()) === null || _a === void 0 ? void 0 : _a.asNumber()) !== null && _b !== void 0 ? _b : 0;\n  };\n  PDFAcroField.prototype.setFlags = function (flags) {\n    this.dict.set(PDFName.of('Ff'), PDFNumber.of(flags));\n  };\n  PDFAcroField.prototype.hasFlag = function (flag) {\n    var flags = this.getFlags();\n    return (flags & flag) !== 0;\n  };\n  PDFAcroField.prototype.setFlag = function (flag) {\n    var flags = this.getFlags();\n    this.setFlags(flags | flag);\n  };\n  PDFAcroField.prototype.clearFlag = function (flag) {\n    var flags = this.getFlags();\n    this.setFlags(flags & ~flag);\n  };\n  PDFAcroField.prototype.setFlagTo = function (flag, enable) {\n    if (enable) this.setFlag(flag);else this.clearFlag(flag);\n  };\n  PDFAcroField.prototype.getInheritableAttribute = function (name) {\n    var attribute;\n    this.ascend(function (node) {\n      if (!attribute) attribute = node.dict.get(name);\n    });\n    return attribute;\n  };\n  PDFAcroField.prototype.ascend = function (visitor) {\n    visitor(this);\n    var parent = this.getParent();\n    if (parent) parent.ascend(visitor);\n  };\n  return PDFAcroField;\n}();\nexport default PDFAcroField;","map":{"version":3,"mappings":"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","names":["PDFDict","PDFString","PDFHexString","PDFName","PDFNumber","PDFArray","PDFRef","findLastMatch","MissingDAEntryError","MissingTfOperatorError","tfRegex","dict","ref","PDFAcroField","lookupMaybe","of","numberOrRef","getInheritableAttribute","context","valueOrRef","lookup","da","undefined","kids","set","obj","parentRef","get","parent_1","parent","delete","getParent","getPartialName","getFullyQualifiedName","T","decodeText","partialName","fromText","appearance","DA","asString","fontSize","name","getDefaultAppearance","daMatch","match","daStart","slice","pos","length","daEnd","fontName","modifiedDa","setDefaultAppearance","Ff","asNumber","flags","flag","getFlags","setFlags","enable","setFlag","clearFlag","attribute","ascend","node","visitor"],"sourceRoot":"","sources":["../../../src/core/acroform/PDFAcroField.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}