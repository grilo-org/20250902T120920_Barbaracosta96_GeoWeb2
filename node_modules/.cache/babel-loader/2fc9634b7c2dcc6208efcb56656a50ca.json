{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { ReparseError } from \"../errors\";\nimport PDFName from \"../objects/PDFName\";\nimport PDFNumber from \"../objects/PDFNumber\";\nimport PDFRef from \"../objects/PDFRef\";\nimport ByteStream from \"./ByteStream\";\nimport PDFObjectParser from \"./PDFObjectParser\";\nimport { waitForTick } from \"../../utils\";\nvar PDFObjectStreamParser = /** @class */function (_super) {\n  __extends(PDFObjectStreamParser, _super);\n  function PDFObjectStreamParser(rawStream, shouldWaitForTick) {\n    var _this = _super.call(this, ByteStream.fromPDFRawStream(rawStream), rawStream.dict.context) || this;\n    var dict = rawStream.dict;\n    _this.alreadyParsed = false;\n    _this.shouldWaitForTick = shouldWaitForTick || function () {\n      return false;\n    };\n    _this.firstOffset = dict.lookup(PDFName.of('First'), PDFNumber).asNumber();\n    _this.objectCount = dict.lookup(PDFName.of('N'), PDFNumber).asNumber();\n    return _this;\n  }\n  PDFObjectStreamParser.prototype.parseIntoContext = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var offsetsAndObjectNumbers, idx, len, _a, objectNumber, offset, object, ref;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (this.alreadyParsed) {\n              throw new ReparseError('PDFObjectStreamParser', 'parseIntoContext');\n            }\n            this.alreadyParsed = true;\n            offsetsAndObjectNumbers = this.parseOffsetsAndObjectNumbers();\n            idx = 0, len = offsetsAndObjectNumbers.length;\n            _b.label = 1;\n          case 1:\n            if (!(idx < len)) return [3 /*break*/, 4];\n            _a = offsetsAndObjectNumbers[idx], objectNumber = _a.objectNumber, offset = _a.offset;\n            this.bytes.moveTo(this.firstOffset + offset);\n            object = this.parseObject();\n            ref = PDFRef.of(objectNumber, 0);\n            this.context.assign(ref, object);\n            if (!this.shouldWaitForTick()) return [3 /*break*/, 3];\n            return [4 /*yield*/, waitForTick()];\n          case 2:\n            _b.sent();\n            _b.label = 3;\n          case 3:\n            idx++;\n            return [3 /*break*/, 1];\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  PDFObjectStreamParser.prototype.parseOffsetsAndObjectNumbers = function () {\n    var offsetsAndObjectNumbers = [];\n    for (var idx = 0, len = this.objectCount; idx < len; idx++) {\n      this.skipWhitespaceAndComments();\n      var objectNumber = this.parseRawInt();\n      this.skipWhitespaceAndComments();\n      var offset = this.parseRawInt();\n      offsetsAndObjectNumbers.push({\n        objectNumber: objectNumber,\n        offset: offset\n      });\n    }\n    return offsetsAndObjectNumbers;\n  };\n  PDFObjectStreamParser.forStream = function (rawStream, shouldWaitForTick) {\n    return new PDFObjectStreamParser(rawStream, shouldWaitForTick);\n  };\n  return PDFObjectStreamParser;\n}(PDFObjectParser);\nexport default PDFObjectStreamParser;","map":{"version":3,"mappings":";AAAA,SAASA,YAAY,QAAE;AACvB,OAAOC,OAAO;AACd,OAAOC,SAAS;AAEhB,OAAOC,MAAM;AACb,OAAOC,UAAU;AACjB,OAAOC,eAAe;AACtB,SAASC,WAAW,QAAE;AAEtB;EAAoCC;EAWlC,+BAAYC,SAAuB,EAAEC,iBAAiC;IAAtE,YACEC,kBAAMN,UAAU,CAACO,gBAAgB,CAACH,SAAS,CAAC,EAAEA,SAAS,CAACI,IAAI,CAACC,OAAO,CAAC;IAE7D,QAAI,GAAKL,SAAS,KAAd;IAEZM,KAAI,CAACC,aAAa,GAAG,KAAK;IAC1BD,KAAI,CAACL,iBAAiB,GAAGA,iBAAiB,IAAK;MAAM,YAAK;IAAL,CAAM;IAC3DK,KAAI,CAACE,WAAW,GAAGJ,IAAI,CAACK,MAAM,CAAChB,OAAO,CAACiB,EAAE,CAAC,OAAO,CAAC,EAAEhB,SAAS,CAAC,CAACiB,QAAQ,EAAE;IACzEL,KAAI,CAACM,WAAW,GAAGR,IAAI,CAACK,MAAM,CAAChB,OAAO,CAACiB,EAAE,CAAC,GAAG,CAAC,EAAEhB,SAAS,CAAC,CAACiB,QAAQ,EAAE;;EACvE;EAEME,gDAAgB,GAAtB;;;;;;YACE,IAAI,IAAI,CAACN,aAAa,EAAE;cACtB,MAAM,IAAIf,YAAY,CAAC,uBAAuB,EAAE,kBAAkB,CAAC;;YAErE,IAAI,CAACe,aAAa,GAAG,IAAI;YAEnBO,uBAAuB,GAAG,IAAI,CAACC,4BAA4B,EAAE;YAC1DC,GAAG,GAAG,CAAC,EAAEC,GAAG,GAAGH,uBAAuB,CAACI,MAAM;;;kBAAEF,GAAG,GAAGC,GAAG;YACzDE,KAA2BL,uBAAuB,CAACE,GAAG,CAAC,EAArDI,YAAY,oBAAEC,MAAM;YAC5B,IAAI,CAACC,KAAK,CAACC,MAAM,CAAC,IAAI,CAACf,WAAW,GAAGa,MAAM,CAAC;YACtCG,MAAM,GAAG,IAAI,CAACC,WAAW,EAAE;YAC3BC,GAAG,GAAG/B,MAAM,CAACe,EAAE,CAACU,YAAY,EAAE,CAAC,CAAC;YACtC,IAAI,CAACf,OAAO,CAACsB,MAAM,CAACD,GAAG,EAAEF,MAAM,CAAC;iBAC5B,IAAI,CAACvB,iBAAiB,EAAE,EAAxB;YAA0B,qBAAMH,WAAW,EAAE;;YAAnB8B,SAAmB;;;YANgBZ,GAAG,EAAE;;;;;;;GAQzE;;EAEOH,4DAA4B,GAApC;IAIE,IAAMC,uBAAuB,GAAG,EAAE;IAClC,KAAK,IAAIE,GAAG,GAAG,CAAC,EAAEC,GAAG,GAAG,IAAI,CAACL,WAAW,EAAEI,GAAG,GAAGC,GAAG,EAAED,GAAG,EAAE,EAAE;MAC1D,IAAI,CAACa,yBAAyB,EAAE;MAChC,IAAMT,YAAY,GAAG,IAAI,CAACU,WAAW,EAAE;MAEvC,IAAI,CAACD,yBAAyB,EAAE;MAChC,IAAMR,MAAM,GAAG,IAAI,CAACS,WAAW,EAAE;MAEjChB,uBAAuB,CAACiB,IAAI,CAAC;QAAEX,YAAY;QAAEC,MAAM;MAAA,CAAE,CAAC;;IAExD,OAAOP,uBAAuB;EAChC,CAAC;EArDMD,+BAAS,GAAG,UACjBb,SAAuB,EACvBC,iBAAiC;IAC9B,WAAIY,qBAAqB,CAACb,SAAS,EAAEC,iBAAiB,CAAC;EAAvD,CAAuD;EAmD9D,4BAAC;CAAA,CAvDmCJ,eAAe;AAyDnD,eAAegB,qBAAqB","names":["ReparseError","PDFName","PDFNumber","PDFRef","ByteStream","PDFObjectParser","waitForTick","__extends","rawStream","shouldWaitForTick","_super","fromPDFRawStream","dict","context","_this","alreadyParsed","firstOffset","lookup","of","asNumber","objectCount","PDFObjectStreamParser","offsetsAndObjectNumbers","parseOffsetsAndObjectNumbers","idx","len","length","_a","objectNumber","offset","bytes","moveTo","object","parseObject","ref","assign","_b","skipWhitespaceAndComments","parseRawInt","push"],"sourceRoot":"","sources":["../../../src/core/parser/PDFObjectStreamParser.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}