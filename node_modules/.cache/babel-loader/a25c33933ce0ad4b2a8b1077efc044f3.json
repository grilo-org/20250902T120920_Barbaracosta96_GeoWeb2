{"ast":null,"code":"import { Encodings, Font, FontNames } from '@pdf-lib/standard-fonts';\nimport PDFHexString from \"../objects/PDFHexString\";\nimport { toCodePoint, toHexString } from \"../../utils\";\n/**\n * A note of thanks to the developers of https://github.com/foliojs/pdfkit, as\n * this class borrows from:\n *   https://github.com/foliojs/pdfkit/blob/f91bdd61c164a72ea06be1a43dc0a412afc3925f/lib/font/afm.coffee\n */\nvar StandardFontEmbedder = /** @class */function () {\n  function StandardFontEmbedder(fontName, customName) {\n    // prettier-ignore\n    this.encoding = fontName === FontNames.ZapfDingbats ? Encodings.ZapfDingbats : fontName === FontNames.Symbol ? Encodings.Symbol : Encodings.WinAnsi;\n    this.font = Font.load(fontName);\n    this.fontName = this.font.FontName;\n    this.customName = customName;\n  }\n  /**\n   * Encode the JavaScript string into this font. (JavaScript encodes strings in\n   * Unicode, but standard fonts use either WinAnsi, ZapfDingbats, or Symbol\n   * encodings)\n   */\n  StandardFontEmbedder.prototype.encodeText = function (text) {\n    var glyphs = this.encodeTextAsGlyphs(text);\n    var hexCodes = new Array(glyphs.length);\n    for (var idx = 0, len = glyphs.length; idx < len; idx++) {\n      hexCodes[idx] = toHexString(glyphs[idx].code);\n    }\n    return PDFHexString.of(hexCodes.join(''));\n  };\n  StandardFontEmbedder.prototype.widthOfTextAtSize = function (text, size) {\n    var glyphs = this.encodeTextAsGlyphs(text);\n    var totalWidth = 0;\n    for (var idx = 0, len = glyphs.length; idx < len; idx++) {\n      var left = glyphs[idx].name;\n      var right = (glyphs[idx + 1] || {}).name;\n      var kernAmount = this.font.getXAxisKerningForPair(left, right) || 0;\n      totalWidth += this.widthOfGlyph(left) + kernAmount;\n    }\n    var scale = size / 1000;\n    return totalWidth * scale;\n  };\n  StandardFontEmbedder.prototype.heightOfFontAtSize = function (size, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    var _a = options.descender,\n      descender = _a === void 0 ? true : _a;\n    var _b = this.font,\n      Ascender = _b.Ascender,\n      Descender = _b.Descender,\n      FontBBox = _b.FontBBox;\n    var yTop = Ascender || FontBBox[3];\n    var yBottom = Descender || FontBBox[1];\n    var height = yTop - yBottom;\n    if (!descender) height += Descender || 0;\n    return height / 1000 * size;\n  };\n  StandardFontEmbedder.prototype.sizeOfFontAtHeight = function (height) {\n    var _a = this.font,\n      Ascender = _a.Ascender,\n      Descender = _a.Descender,\n      FontBBox = _a.FontBBox;\n    var yTop = Ascender || FontBBox[3];\n    var yBottom = Descender || FontBBox[1];\n    return 1000 * height / (yTop - yBottom);\n  };\n  StandardFontEmbedder.prototype.embedIntoContext = function (context, ref) {\n    var fontDict = context.obj({\n      Type: 'Font',\n      Subtype: 'Type1',\n      BaseFont: this.customName || this.fontName,\n      Encoding: this.encoding === Encodings.WinAnsi ? 'WinAnsiEncoding' : undefined\n    });\n    if (ref) {\n      context.assign(ref, fontDict);\n      return ref;\n    } else {\n      return context.register(fontDict);\n    }\n  };\n  StandardFontEmbedder.prototype.widthOfGlyph = function (glyphName) {\n    // Default to 250 if font doesn't specify a width\n    return this.font.getWidthOfGlyph(glyphName) || 250;\n  };\n  StandardFontEmbedder.prototype.encodeTextAsGlyphs = function (text) {\n    var codePoints = Array.from(text);\n    var glyphs = new Array(codePoints.length);\n    for (var idx = 0, len = codePoints.length; idx < len; idx++) {\n      var codePoint = toCodePoint(codePoints[idx]);\n      glyphs[idx] = this.encoding.encodeUnicodeCodePoint(codePoint);\n    }\n    return glyphs;\n  };\n  StandardFontEmbedder.for = function (fontName, customName) {\n    return new StandardFontEmbedder(fontName, customName);\n  };\n  return StandardFontEmbedder;\n}();\nexport default StandardFontEmbedder;","map":{"version":3,"mappings":"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","names":["Encodings","Font","FontNames","PDFHexString","toCodePoint","toHexString","fontName","customName","encoding","ZapfDingbats","Symbol","WinAnsi","font","load","FontName","StandardFontEmbedder","text","glyphs","encodeTextAsGlyphs","hexCodes","Array","length","idx","len","code","of","join","size","totalWidth","left","name","right","kernAmount","getXAxisKerningForPair","widthOfGlyph","scale","options","descender","Ascender","Descender","FontBBox","yTop","yBottom","height","context","ref","fontDict","obj","Type","Subtype","BaseFont","Encoding","undefined","assign","register","glyphName","getWidthOfGlyph","codePoints","from","codePoint","encodeUnicodeCodePoint"],"sourceRoot":"","sources":["../../../src/core/embedders/StandardFontEmbedder.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}