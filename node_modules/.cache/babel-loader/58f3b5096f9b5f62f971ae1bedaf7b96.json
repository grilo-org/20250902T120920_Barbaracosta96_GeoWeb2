{"ast":null,"code":"import { __extends } from \"tslib\";\nimport PDFAcroTerminal from \"./PDFAcroTerminal\";\nimport PDFHexString from \"../objects/PDFHexString\";\nimport PDFString from \"../objects/PDFString\";\nimport PDFArray from \"../objects/PDFArray\";\nimport PDFName from \"../objects/PDFName\";\nimport { AcroChoiceFlags } from \"./flags\";\nimport { InvalidAcroFieldValueError, MultiSelectValueError } from \"../errors\";\nvar PDFAcroChoice = /** @class */function (_super) {\n  __extends(PDFAcroChoice, _super);\n  function PDFAcroChoice() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  PDFAcroChoice.prototype.setValues = function (values) {\n    if (this.hasFlag(AcroChoiceFlags.Combo) && !this.hasFlag(AcroChoiceFlags.Edit) && !this.valuesAreValid(values)) {\n      throw new InvalidAcroFieldValueError();\n    }\n    if (values.length === 0) {\n      this.dict.delete(PDFName.of('V'));\n    }\n    if (values.length === 1) {\n      this.dict.set(PDFName.of('V'), values[0]);\n    }\n    if (values.length > 1) {\n      if (!this.hasFlag(AcroChoiceFlags.MultiSelect)) {\n        throw new MultiSelectValueError();\n      }\n      this.dict.set(PDFName.of('V'), this.dict.context.obj(values));\n    }\n    this.updateSelectedIndices(values);\n  };\n  PDFAcroChoice.prototype.valuesAreValid = function (values) {\n    var options = this.getOptions();\n    var _loop_1 = function (idx, len) {\n      var val = values[idx].decodeText();\n      if (!options.find(function (o) {\n        return val === (o.display || o.value).decodeText();\n      })) {\n        return {\n          value: false\n        };\n      }\n    };\n    for (var idx = 0, len = values.length; idx < len; idx++) {\n      var state_1 = _loop_1(idx, len);\n      if (typeof state_1 === \"object\") return state_1.value;\n    }\n    return true;\n  };\n  PDFAcroChoice.prototype.updateSelectedIndices = function (values) {\n    if (values.length > 1) {\n      var indices = new Array(values.length);\n      var options = this.getOptions();\n      var _loop_2 = function (idx, len) {\n        var val = values[idx].decodeText();\n        indices[idx] = options.findIndex(function (o) {\n          return val === (o.display || o.value).decodeText();\n        });\n      };\n      for (var idx = 0, len = values.length; idx < len; idx++) {\n        _loop_2(idx, len);\n      }\n      this.dict.set(PDFName.of('I'), this.dict.context.obj(indices.sort()));\n    } else {\n      this.dict.delete(PDFName.of('I'));\n    }\n  };\n  PDFAcroChoice.prototype.getValues = function () {\n    var v = this.V();\n    if (v instanceof PDFString || v instanceof PDFHexString) return [v];\n    if (v instanceof PDFArray) {\n      var values = [];\n      for (var idx = 0, len = v.size(); idx < len; idx++) {\n        var value = v.lookup(idx);\n        if (value instanceof PDFString || value instanceof PDFHexString) {\n          values.push(value);\n        }\n      }\n      return values;\n    }\n    return [];\n  };\n  PDFAcroChoice.prototype.Opt = function () {\n    return this.dict.lookupMaybe(PDFName.of('Opt'), PDFString, PDFHexString, PDFArray);\n  };\n  PDFAcroChoice.prototype.setOptions = function (options) {\n    var newOpt = new Array(options.length);\n    for (var idx = 0, len = options.length; idx < len; idx++) {\n      var _a = options[idx],\n        value = _a.value,\n        display = _a.display;\n      newOpt[idx] = this.dict.context.obj([value, display || value]);\n    }\n    this.dict.set(PDFName.of('Opt'), this.dict.context.obj(newOpt));\n  };\n  PDFAcroChoice.prototype.getOptions = function () {\n    var Opt = this.Opt();\n    // Not supposed to happen - Opt _should_ always be `PDFArray | undefined`\n    if (Opt instanceof PDFString || Opt instanceof PDFHexString) {\n      return [{\n        value: Opt,\n        display: Opt\n      }];\n    }\n    if (Opt instanceof PDFArray) {\n      var res = [];\n      for (var idx = 0, len = Opt.size(); idx < len; idx++) {\n        var item = Opt.lookup(idx);\n        // If `item` is a string, use that as both the export and text value\n        if (item instanceof PDFString || item instanceof PDFHexString) {\n          res.push({\n            value: item,\n            display: item\n          });\n        }\n        // If `item` is an array of one, treat it the same as just a string,\n        // if it's an array of two then `item[0]` is the export value and\n        // `item[1]` is the text value\n        if (item instanceof PDFArray) {\n          if (item.size() > 0) {\n            var first = item.lookup(0, PDFString, PDFHexString);\n            var second = item.lookupMaybe(1, PDFString, PDFHexString);\n            res.push({\n              value: first,\n              display: second || first\n            });\n          }\n        }\n      }\n      return res;\n    }\n    return [];\n  };\n  return PDFAcroChoice;\n}(PDFAcroTerminal);\nexport default PDFAcroChoice;","map":{"version":3,"mappings":"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","names":["PDFAcroTerminal","PDFHexString","PDFString","PDFArray","PDFName","AcroChoiceFlags","InvalidAcroFieldValueError","MultiSelectValueError","__extends","PDFAcroChoice","values","hasFlag","Combo","Edit","valuesAreValid","length","dict","delete","of","set","MultiSelect","context","obj","updateSelectedIndices","options","getOptions","idx","len","val","decodeText","find","o","display","value","indices","Array","findIndex","sort","v","V","size","lookup","push","lookupMaybe","newOpt","Opt","res","item","first","second"],"sourceRoot":"","sources":["../../../src/core/acroform/PDFAcroChoice.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}